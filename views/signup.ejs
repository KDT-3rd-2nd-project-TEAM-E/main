<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Page</title>
    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="/static/css/signup.css" />
  </head>

  <body>
    <div class="container">
      <div class="wrap">
        <div class="title">
          <h2>회원가입</h2>
          <span>가입을 통해 더 다양한 서비스를 만나보세요!</span>
        </div>
        <hr />

=======
        <!--  action="/signup" method="post"   -->
        <form name="form_register">

          <section id="firstSection" class="">
            <div class="signupId">
              <input
                type="text"
                class="inputBox"
                name="userid"
                id="userid"
                placeholder="아이디 입력 (숫자, 영문 조합 5~12자리)"
                required
              />
              <button
                class="btn btn-outline-secondary"
                type="button"
                id="checkId"
                onclick="idCheck();"
              >
                중복 확인
              </button>
            </div>
            <div id="idError" class="error"></div>

            <div class="signupPw">
              <input
                type="password"
                class="inputBox"
                name="userpw"
                id="userpw"
                placeholder="비밀번호 입력 (숫자, 영문, 특수문자 조합 8~16자리)"
                required
              />
              <div id="pwError" class="error"></div>
            </div>

            <div class="signupPwCheck">
              <input
                type="password"
                class="inputBox"
                name="checkpw"
                id="checkpw"
                placeholder="비밀번호 재입력"
                required
              />
              <div id="pwError" class="error"></div>
            </div>

            <div class="next">
              <button
                type="button"
                class="btn"
                id="nextBtn"
                onclick="firstNext();"
              >
                다음 &gt;
              </button>
              <br />
            </div>
          </section>

          <section id="secondSection" class="d-none">
            <div class="emailBox">
              <label for="">이메일</label>
              <input
                type="email"
                class="inputBox"
                name="useremail"
                id="useremail"
                placeholder="이메일 입력(abc@example.com)"
                required
              />
              <div id="emailError" class="error"></div>
            </div>

            <div class="oneline">
              <div class="nicknameBox">
                <label>닉네임</label>
                <input
                  type="text"
                  class="inputBox"
                  name="nickname"
                  id="nickname"
                  placeholder="영문, 숫자 16자 / 한글 8자 이내"
                  onkeyup="javascript:fnChkByte(this, '16')"
                />
                <div id="nameError" class="error"></div>
              </div>
              <div class="genderBox">
                <label>성별</label>
                <label>
                  <input
                    type="radio"
                    name="gender"
                    id="genderM"
                    value="M"
                    required
                  />
                  <span>남</span>
                </label>
                <label>
                  <input type="radio" name="gender" id="genderF" value="F" />
                  <span>여</span>
                </label>
              </div>
            </div>
            <div class="oneline">
              <div class="ageBox">
                <label>나이</label>
                <input
                  type="number"
                  class="inputBox"
                  name="userage"
                  id="userage"
                  min="14"
                  max="99"
                  placeholder="14 ~ 99"
                  required
                />세
                <div id="ageError" class="error"></div>
              </div>

              <div class="heightBox">
                <label>키</label>
                <input
                  type="number"
                  class="inputBox"
                  name="userheight"
                  id="userheight"
                  min="100"
                  max="230"
                  placeholder="100 ~ 230"
                  required
                />cm
                <div id="heightError" class="error"></div>
              </div>
            </div>

            <div class="next">
              <button
                type="button"
                class="btn"
                id="nextBtn"
                onclick="secondNext();"
              >
                다음 &gt;
              </button>
              <br />
            </div>
          </section>

          <section id="thirdSection" class="d-none">
            <div class="weightBox">
              <label>몸무게</label>
              <input
                type="number"
                class="inputBox"
                name="userweight"
                id="userweight"
                min="10"
                max="999"
                required
              />kg
              <div id="weightError" class="error"></div>
            </div>
            <img src="/static/img/yoga.png" id="exImg" alt="설명대체이미지" />
            <div class="login">

              <button type="button" id="loginBtn" onclick="register();">

                가입완료!
              </button>
              <br />
            </div>
          </section>
        </form>
      </div>
    </div>

    <!-- <script src="/static/js/signup.js"></script> -->

    <script>
      // id 중복확인 버튼 눌렀을 때 검사
      const form = document.forms["form_register"];
      const msg = document.querySelector("#idError");

      function idCheck() {
        console.log("중복확인 클릭");
        //console.log(data.userid.value);
        console.dir(form);

        const data = {
          userid: form.userid.value,
        };

        //정규식
        let regId = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{5,12}$/;

        if (!form.userid.checkValidity()) {
          alert("아이디를 입력해주세요.");
          userid.focus();
          msg.textContent = "";

          return;
        }

        if (!regId.test(data.userid)) {
          alert(
            "아이디는 최소 5자 최대 12자 이내의 숫자, 영문 조합으로 만들어주세요."
          );
          userid.focus();
          msg.textContent = "";

          return;
        } else {
          msg.textContent = "아이디 사용이 가능합니다!";
          return;
        }
      }

      // 회원가입 first Section 다음 버튼 눌렀을 때 유효성 검사
      function firstNext() {
        const data = {
          userid: form.userid.value,
          userpw: form.userpw.value,
          checkpw: form.checkpw.value,
        };
        // 1. ID ) 중복확인 검사 X
        if (msg.innerHTML == "") {
          alert("아이디 중복검사를 해주세요.");
          return;
        }

        // 2. PW) 비밀번호 or 비밀번호확인 input 입력 X
        if (data.userpw == "") {
          alert("비밀번호를 입력해주세요.");
          userpw.focus();
          return;
        } else if (data.checkpw == "") {
          alert("비밀번호 확인이 필요합니다.");
          checkpw.focus();
        }

        //3. PW ) 비밀번호 유효성 검사
        // (숫자, 영문, 특수문자 조합 8~16자리), (공백 space X)
        let regPw =
          /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,16}$/;

        if (!regPw.test(data.userpw)) {
          alert(
            "비밀번호는 공백을 제외한 최소 8자 최대 16자 이내 숫자, 영문, 특수문자를 모두 포함하여 작성해주세요."
          );
          userpw.focus();
          return;
        }

        // 4. 비밀번호 != 비밀번호 확인 (불일치)
        if (data.userpw !== data.checkpw) {
          alert("비밀번호가 일치하지 않습니다.");
          checkpw.focus();
          return;
        } else {
          console.log("다음으로 넘어간닷!!!!!");
          document.getElementById("firstSection").classList.add("d-none");
          document.getElementById("secondSection").classList.remove("d-none");
        }
      }

      // 닉네임 글자수 제한 (16Byte)
      function fnChkByte(obj, maxByte) {
        var str = obj.value;
        var str_len = str.length;

        console.log(str);
        var rbyte = 0;
        var rlen = 0;
        var one_char = "";
        var str2 = "";

        for (var i = 0; i < str_len; i++) {
          one_char = str.charAt(i);
          if (escape(one_char).length > 4) {
            rbyte += 2; //한글 2byte
          } else {
            rbyte++; // 나머지 1byte
          }

          if (rbyte <= maxByte) {
            rlen = i + 1; // return 할 문자열 갯수
          }
        }
        if (rbyte > maxByte) {
          alert("닉네임은 영문, 숫자 16자(한글 8자)를 초과할 수 없습니다.");
          str2 = str.substr(0, rlen);
          obj.value = str2;
          fnChkByte(obj, maxByte);
        } else {
          return;
        }
      }

      function secondNext() {
        const data = {
          useremail: form.useremail.value,
          gender: form.gender.value,
          nickname: form.nickname.value,
          age: form.userage.value,
          height: form.userheight.value,
        };

        if (data.useremail == "") {
          alert("이메일을 입력해주세요.");
          useremail.focus();
          return;
        }
        if (data.nickname == "") {
          alert("닉네임을 입력해주세요.");
          document.querySelector("#nickname").focus();
          return;
        }

        if (data.age == "") {
          alert("나이를 입력해주세요.");
          document.querySelector("#userage").focus();
          return;
        } else if (data.age < 14 || data.age > 99) {
          alert("나이는 14세 이상 99세 이하로 입력가능합니다.");
          document.querySelector("#userage").focus();
          return;
        }

        if (data.height == "") {
          alert("키를 입력해주세요.");
          document.querySelector("#userheight").focus();
          return;
        } else if (data.height < 100 || data.height > 230) {
          alert("키는 100cm 이상 230cm 이하로 입력 가능합니다");
          document.querySelector("#userheight").focus();
          return;
        }

        if (data.gender == "") {
          alert("성별을 선택해주세요.");
          return;
        } else {
          console.log("가보자고!!!!!");
          document.getElementById("secondSection").classList.add("d-none");
          document.getElementById("thirdSection").classList.remove("d-none");
        }
      }

      function register() {
        const data = {
          userid: form.userid.value,
          userpw: form.userpw.value,
          useremail: form.useremail.value,
          nickname: form.nickname.value,
          gender: form.gender.value,
          age: form.userage.value,
          height: form.userheight.value,
          weight: form.userweight.value,
        };

        if (data.weight == "" || data.weight < 10 || data.weight > 999) {
          alert("몸무게는 10kg 이상 999kg 이하로 입력해주세요.");
          document.querySelector("#userweight").focus();
          return;
        }

        axios({
          method: "POST",
          url: "/signup",
          data: {
            userid: data.userid,
            userpw: data.userpw,
            useremail: data.useremail,
            nickname: data.nickname,
            gender: data.gender,
            age: data.age,
            height: data.height,
            weight: data.weight,
          },
        }).then((res) => {
          // axios({
          //   method: "POST",
          //   url: "/signup", // url: "/postsignweightup",
          //   data: {
          //     userid: data.userid,
          //     weight: data.weight,
          //   },
          // }).then((res) => {
          //   return res.data;
          // });
          if (true) {
            window.location.href = "/login";
            return;
          } else {
            alert("회원가입이 올바르게 되지 않았습니다. 다시 시도해주세요!");
            window.location.href = "/signup";
          }

        });
      }
    </script>
  </body>
</html>
